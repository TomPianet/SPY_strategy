<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SPY Strategy — Home</title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <div class="wrap">
    <div class="nav">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <b>SPY Timing + Allocation</b><br>
          <span>Thesis demo website</span>
        </div>
      </div>
      <div class="navlinks">
        <a href="index.html">Home</a>
        <a href="results.html">Results</a>
        <a href="methodology.html">Methodology</a>
      </div>
    </div>

    <header class="header">
      <div>
        <h1>Strategy overview</h1>
        <p class="subtitle">
          Goal: test whether a rules-based weekly allocation across <span class="mono">SPY / TLT / GLD / BIL</span>
          can outperform Buy & Hold SPY, including leveraged Buy & Hold variants (1.3x and 2.0x), net of costs and financing.
        </p>
        <div class="pills">
          <span class="pill" id="lastUpdated">Loading…</span>
          <span class="pill" id="lastBacktest">—</span>
          <span class="pill" id="sampleUsed">—</span>
        </div>
      </div>

      <div style="max-width:420px">
        <div class="card" style="padding:14px">
          <div style="font-weight:600; margin-bottom:6px">Disclaimer</div>
          <div class="small">
            This website is for academic research and educational purposes only and does not constitute investment advice.
            Past performance does not guarantee future results.
          </div>
        </div>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>What the strategy does (simple)</h2>
        <div class="small">
          Each week, the model outputs target portfolio weights across SPY (equities), TLT (bonds),
          GLD (gold), and BIL (cash). The allocation can become slightly leveraged when BIL is negative (borrowing).
          All numbers shown here are generated by the same backtest pipeline used in the thesis.
        </div>

        <hr class="sep">

        <h2>Key headline metrics</h2>
        <div class="small" style="margin-bottom:10px">Shown for Strategy vs SPY (and leveraged SPY if available).</div>
        <div class="kpis">
          <div class="kpi"><div class="label">Strategy YTD</div><div class="value" id="kpiStrYTD">—</div></div>
          <div class="kpi"><div class="label">Strategy Sharpe</div><div class="value" id="kpiStrSharpe">—</div></div>
          <div class="kpi"><div class="label">Strategy Max Drawdown</div><div class="value" id="kpiStrMaxDD">—</div></div>
          <div class="kpi"><div class="label">$1,000 → Today (Strategy)</div><div class="value" id="kpi1000">—</div></div>
        </div>
      </section>

      <aside class="card">
        <h2>Next week allocation</h2>
        <div class="small" id="recoAsOf">Loading…</div>

        <div style="margin-top:10px">
          <table>
            <thead><tr><th>Asset</th><th class="right">Weight</th></tr></thead>
            <tbody id="weightsBody"></tbody>
          </table>
        </div>

        <div class="small" style="margin-top:10px" id="recoFlags"></div>
      </aside>
    </div>

    <section class="card">
      <h2>Performance summary (net of costs + financing)</h2>
      <div class="small" style="margin-bottom:10px">
        Loaded from <span class="mono">docs/data/latest.json</span>.
      </div>

      <table>
        <thead>
          <tr>
            <th>Series</th>
            <th class="right">YTD</th>
            <th class="right">CAGR</th>
            <th class="right">Vol</th>
            <th class="right">Sharpe</th>
            <th class="right">Sortino</th>
            <th class="right">MaxDD</th>
            <th class="right">Calmar</th>
          </tr>
        </thead>
        <tbody id="summaryBody"></tbody>
      </table>

      <div class="footer">
        Updating is simple: re-run Colab → replace files inside <span class="mono">docs/data/</span> → commit/push.
      </div>
    </section>
  </div>

  <script type="module">
    import {fmtPct, fmtNum, esc, loadJSON, loadCSV, setActiveNav, latestValueFromCSV, yearStartValueFromCSV} from "./assets/app.js";
    setActiveNav();

    function renderSummary(summary){
      const tbody = document.getElementById("summaryBody");
      tbody.innerHTML = "";

      const order = ["Strategy_Net","BuyHold_SPY","BuyHold_SPY_1.3x_Net","BuyHold_SPY_2.0x_Net"];
      order.forEach(name => {
        if(!summary[name]) return;
        const s = summary[name];

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="mono">${esc(name)}</td>
          <td class="right mono">${fmtPct(s.YTD)}</td>
          <td class="right mono">${fmtPct(s.CAGR)}</td>
          <td class="right mono">${fmtPct(s.Vol)}</td>
          <td class="right mono">${fmtNum(s.Sharpe)}</td>
          <td class="right mono">${fmtNum(s.Sortino)}</td>
          <td class="right mono">${fmtPct(s.MaxDD)}</td>
          <td class="right mono">${fmtNum(s.Calmar)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function renderReco(reco){
      document.getElementById("recoAsOf").textContent = "As of: " + (reco.as_of || "—");

      const wb = document.getElementById("weightsBody");
      wb.innerHTML = "";
      const w = reco.weights || {SPY:0,TLT:0,GLD:0,BIL:1};

      ["SPY","TLT","GLD","BIL"].forEach(a => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="mono">${a}</td>
          <td class="right mono">${(Number(w[a]) * 100).toFixed(2)}%</td>
        `;
        wb.appendChild(tr);
      });

      const lev = reco.leverage ? "Leverage ON" : "Leverage OFF";
      const cls = reco.leverage ? "warn" : "good";
      const risky = (reco.risky_gross !== undefined) ? Number(reco.risky_gross).toFixed(4) : "—";
      document.getElementById("recoFlags").innerHTML =
        `<span class="${cls}"><b>${lev}</b></span>
         <span class="small"> • risky gross: <span class="mono">${risky}x</span></span><br>
         <span class="small">${reco.note || ""}</span>`;
    }

    async function main(){
      const latest = await loadJSON("data/latest.json");

      document.getElementById("lastUpdated").textContent =
        "Updated: " + (latest.updated_at ? String(latest.updated_at).replace("T"," ").replace("Z"," UTC") : "—");

      document.getElementById("lastBacktest").textContent =
        "Last backtest date: " + (latest.last_backtest_date || "—");

      document.getElementById("sampleUsed").textContent =
        "Metrics sample: " + (latest.sample_used_for_metrics || "—");

      renderSummary(latest.summary || {});
      renderReco(latest.recommendation || {});

      // KPIs (Strategy)
      const s = (latest.summary || {}).Strategy_Net || {};
      document.getElementById("kpiStrYTD").textContent = fmtPct(s.YTD);
      document.getElementById("kpiStrSharpe").textContent = fmtNum(s.Sharpe);
      document.getElementById("kpiStrMaxDD").textContent = fmtPct(s.MaxDD);

      // $1,000 growth from equity curve CSV (Strategy_Net_Eq)
      // If CSV missing, KPI stays "—"
      try{
        const csv = await loadCSV("data/equity_curve_TURBO_phase7_BASE.csv");
        const lastEq = latestValueFromCSV(csv, "Strategy_Net_Eq");
        if(!Number.isNaN(lastEq)){
          document.getElementById("kpi1000").textContent = "$" + (1000 * lastEq).toFixed(0);
        }

        // also: if you want “$1,000 from start of current year”
        // note: YTD and "start of 2026" are the same *only when the current year is 2026*
        const year = new Date().getFullYear();
        const base = yearStartValueFromCSV(csv, "Strategy_Net_Eq", year);
        if(!Number.isNaN(base) && !Number.isNaN(lastEq)){
          // you could display it somewhere later if you want
        }
      }catch(e){ /* ignore */ }
    }

    main().catch(err => {
      console.error(err);
      document.getElementById("lastUpdated").textContent = "Error loading data (check docs/data file names).";
    });
  </script>
</body>
</html>
